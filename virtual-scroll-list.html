<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>web ui examples</title>
<style>
#pane {
  width: 200px;
  height: 300px;
  overflow: auto;
  background-color: #eee;
  position: relative; /* needed for IE7 */
}
#content {
  position: relative;
}
.row {
  position: absolute;
  width: 200px;
  border-width: 1px 0 1px 0;
  border-style: solid;
}
</style>
</head>
<body>
<div id="pane">
<div id="content">
</div>
</div>
<script src="js/jquery-1.11.0.js"></script>
<script>
$(function() {
  var MAX_CONTENT_HEIGHT = 1000000;
  var dataCount = 100000;

  function measureRowHeight() {
    var row = $('<div class="row"/>').appendTo("#content");
    adjustRow(row, 0, 0);
    var rowHeight = row.outerHeight();
    row.remove();
    return rowHeight;
  }

  function buildRowContent(div, i) {
    div.text(i + 1);
  }

  function adjustRow(div, i, scrollTop, startIndex) {
    div.css('top', (i - (startIndex || 0)) * rowHeight + (scrollTop || 0));
    div.data("row", i);
    buildRowContent(div, i);
  }

  var rowHeight = measureRowHeight();
  console.log("rowHeight", rowHeight);
  var totalHeight = rowHeight * dataCount;
  var contentHeight = Math.min(totalHeight, MAX_CONTENT_HEIGHT);
  var realVirtualHeightRatio = contentHeight / totalHeight;
  $("#content").css("height", contentHeight);
  console.log("totalHeight", rowHeight * dataCount, "contentHeight", contentHeight);

  var pane = $("#pane");
  var paneHeight = pane.outerHeight();
  var rowCount = Math.ceil(paneHeight / rowHeight) + 1;
  console.log("rowCount", rowCount);
  var rows = [];
  var hiddenRows = [];

  function initRows() {
    for (var i = 0; i < rowCount; i++) {
      var row = $('<div class="row"/>').appendTo("#content");
      adjustRow(row, i, 0);
      rows.push(row);
    }
  }

  initRows();
  pane.scroll(function(e) {
    var scrollTop = $(this).scrollTop(),
      startPos = scrollTop / contentHeight,
      startIndex = Math.floor(dataCount * startPos),
      endIndex = Math.min(startIndex + rowCount, dataCount),
      i, row;
    console.log("startPos", startPos, "startIndex", startIndex, "endIndex", endIndex);
    console.log("scrollTop", scrollTop, "scrollTop+paneHeight", scrollTop + paneHeight);
    for (i = startIndex; i <= endIndex; i++) {
      row = rows[i - startIndex];
      adjustRow(row, i, scrollTop, startIndex);
    }
    for (i = endIndex - startIndex; i < rowCount; i++) {
      row.css('top', -rowHeight);
    }
  });
});
</script>
</body>
</html>
