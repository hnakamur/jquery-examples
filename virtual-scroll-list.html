<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>web ui examples</title>
<style>
#pane {
  width: 200px;
  height: 300px;
  overflow: auto;
  background-color: #eee;
  position: relative; /* needed for IE7 */
}
#content {
  position: relative;
}
.row {
  position: absolute;
  width: 200px;
  border-width: 1px 0 1px 0;
  border-style: solid;
}
</style>
</head>
<body>
<div id="pane">
<div id="content">
</div>
</div>
<script src="js/jquery-1.11.0.js"></script>
<script>
$(function() {
  var dataCount = 1e6; // a million

  function measureRowHeight() {
    var row = $('<div class="row"/>').appendTo("#content");
    adjustRow(row, 0);
    var rowHeight = row.outerHeight();
    row.remove();
    return rowHeight;
  }

  function buildRowContent(div, i) {
    div.text(i + 1);
  }

  function adjustRow(div, i) {
    div.css('top', i * rowHeight);
    div.data("row", i);
    buildRowContent(div, i);
  }

  var rowHeight = measureRowHeight();
  var totalHeight = rowHeight * dataCount;
  var contentHeight = totalHeight;
  var realVirtualHeightRatio = contentHeight / totalHeight;
  $("#content").css("height", contentHeight);
  console.log("totalHeight", totalHeight, "contentHeight", contentHeight, "actualContentHeight", $("#content").css("height"));

  var pane = $("#pane");
  var paneHeight = pane.outerHeight();
  var rowCount = Math.ceil(paneHeight / rowHeight) + 2;
  console.log("viewportH", paneHeight, "rowHeight", rowHeight, "rowCount", rowCount);
  console.log("viewportScrollTopMax", contentHeight - paneHeight);
  var rows = [];
  var hiddenRows = [];

  function initRows() {
    for (var i = 0; i < rowCount; i++) {
      var row = $('<div class="row"/>').appendTo("#content");
      adjustRow(row, i, 0);
      rows.push(row);
    }
  }

  initRows();
  pane.scroll(function(e) {
    var scrollTop = Math.min($(this).scrollTop(), contentHeight - paneHeight),
        startIndex = Math.floor(scrollTop / rowHeight),
        endIndex = Math.ceil((scrollTop + paneHeight) / rowHeight),
        i, row;
    console.log("startIndex", startIndex, "endIndex", endIndex, "count", endIndex - startIndex + 1);
    console.log("scrollTop", scrollTop, "contentHeight-paneHeight", contentHeight - paneHeight);
    for (i = startIndex; i < endIndex; i++) {
      row = rows[i - startIndex];
      adjustRow(row, i);
    }
  });
});
</script>
</body>
</html>
