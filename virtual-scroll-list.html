<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<title>web ui examples</title>
<style>
#pane {
  width: 200px;
  height: 300px;
  overflow: auto;
  background-color: #eee;
  position: relative; /* needed for IE7 */
}
#content {
  position: relative;
}
.row {
  position: absolute;
  width: 200px;
  border-width: 1px 0 1px 0;
  border-style: solid;
}
</style>
</head>
<body>
<div id="pane">
<div id="content">
</div>
</div>
<script src="js/jquery-1.11.0.js"></script>
<script>
$(function() {
  var dataCount = 10000;

  function measureRowHeight() {
    var row = $('<div class="row"/>').appendTo("#content");
    adjustRow(row, 0);
    var rowHeight = row.outerHeight();
    row.remove();
    return rowHeight;
  }

  function buildRowContent(div, i) {
    div.text(i + 1);
  }

  function adjustRow(div, i) {
    div.css('top', i * rowHeight);
    div.data("row", i);
    buildRowContent(div, i);
  }

  var rowHeight = measureRowHeight();
  $("#content").css("height", rowHeight * dataCount);

  var pane = $("#pane");
  var paneHeight = pane.outerHeight();
  var rowCount = Math.ceil(paneHeight / rowHeight) + 1;
  var rows = {};
  var hiddenRows = [];

  function initRows() {
    for (var i = 0; i < rowCount; i++) {
      var row = $('<div class="row"/>').appendTo("#content");
      adjustRow(row, i);
      rows[i] = row;
    }
  }

  function collectHiddenRows(rows, startIndex, endIndex) {
    for (var i in rows) {
      if (!(startIndex <= i && i < endIndex)) {
        hiddenRows.push(rows[i]);
        delete rows[i];
      }
    }
  }

  initRows();
  pane.scroll(function(e) {
    var scrollTop = $(this).scrollTop(),
      startIndex = Math.floor(scrollTop / rowHeight),
      endIndex = Math.min(Math.floor((scrollTop + paneHeight) / rowHeight) + 1, dataCount),
      i, row;
    collectHiddenRows(rows, startIndex, endIndex);
    for (i = startIndex; i < endIndex; i++) {
      if (!rows[i]) {
        row = hiddenRows.shift();
        adjustRow(row, i);
        rows[i] = row;
      }
    }
  });
});
</script>
</body>
</html>
